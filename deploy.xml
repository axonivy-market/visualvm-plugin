<project name="Ivy VisualVM Plugin" default="deploy" xmlns:artifact="antlib:org.apache.maven.artifact.ant">
  <description>
    Sign and deploy the VisualVM plugin to Zugprorepo
  </description>

  <typedef resource="org/apache/maven/artifact/ant/antlib.xml"
           uri="antlib:org.apache.maven.artifact.ant"
           classpath="antlibs/maven-ant-tasks-2.1.3.jar" />
		   
  <property name="cert.location" value="keystore.jks" />
  <property name="cert.type" value="jks" />
  <property name="cert.password" value="?" />
  <property name="cert.alias" value="AXON IVY AG" />
  <property name="cert.tsaurl" value="http://timestamp.digicert.com/" description="URL for a timestamp authority"/>
  
  <property name="deploy.url" value="http://192.168.3.122/nexus/content/repositories/build-vn-snapshots" />
  <property name="deploy.username" value="build-teamUP" />
  <property name="deploy.password" value="buildivyup123" />
  
  <target name="deploy">
    
    <!-- Find the NBM file -->
    <fileset id="fileset.des.nbm" dir="target/nbm">
        <include name="*SNAPSHOT.nbm" />
      </fileset>
      <pathconvert property="file.plugin.nbm" refid="fileset.des.nbm" setonempty="false" />
    
    <!-- Sign the NBM file -->
    <signjar
      jar="${file.plugin.nbm}"
      keystore="${cert.location}"
      storetype="${cert.type}"
      storepass="${cert.password}"
      alias="${cert.alias}"
      tsaurl="${cert.tsaurl}">
    </signjar>
    
    <!-- Deploy to repository -->
      <artifact:pom id="visualvm-plugin" file="pom.xml"/>
      <artifact:deploy file="${file.plugin.nbm}">
        <remoteRepository url="${deploy.url}">
          <authentication username="${deploy.username}" password="${deploy.password}"/>
        </remoteRepository>
        <pom refid="visualvm-plugin"/>
      </artifact:deploy>

  </target>
  
</project>
